# 数据中台



## 课程技术栈

- Spark：Apache Spark 3.0.0
- Hadoop：2.6.0-cdh5.14.4
- MySQL：5.6+
- DataX：3.0
- Java：1.8.0
- Scala：2.12.10







![image-20230321175934222](https://p.ipic.vip/xe7vvc.png)

数据汇聚是数据中台必须提供的核心工具，将其内外部的各个系统数据汇聚实现集中存储。从物理上打破数据孤岛。



## 中台的前世今生

### 中台的缘起

中台进化：

1. 阶段1：烟囱式架构

   优点：

   ![image-20230322100014578](https://p.ipic.vip/t0yg6l.png)

   缺点：

   ![image-20230322100132946](https://p.ipic.vip/u4dece.png)

2. 阶段2：共性平台化架构

   优点：

   ![image-20230322100259660](https://p.ipic.vip/n3u8qu.png)

   缺点：

   ![image-20230322100407208](https://p.ipic.vip/pwqmfy.png)

   ![image-20230322100509460](https://p.ipic.vip/y9ua1x.png)

3. 阶段3：中台

   优点：

   ![image-20230322100543310](https://p.ipic.vip/r3w6dt.png)

### 中台的演进

- 中台的演进过程
  1. 业务中台
  2. 业务/数据双中台
  3. 更多细粒度的中台

- 数据中台和其它中台的关系
  - 数据中台是一切中台的基础
  - 数据中台的应用闭环

## 数据中台体系

### 数据应用的发展阶段

1. 传统数据仓库EDW阶段
   - 定位：数据支持经营决策。
   - 数据形态：关系型数据为主，体量相对较小。
   - 关键技术：商业数据库，ETL/BI工具。
   - 应用场景：BI报表工具、决策分析。

2. 数据驱动的数据糊阶段
   - 定位：业务和数据深度融合。
   - 数据形态：数据形式多样、数据量大、数据标准化。
   - 关键技术：hadoop生态生态体系，机器学习/深度学习。
   - 应用场景：决策分析、针对性营销/推荐、用户画像。


3. 数据中台阶段
   - 定位：企业级数据共享战略。
   - 数据形态：全域数据汇聚，体系化的数据资产。
   - 关键技术：平台化、通用工具、产品、统一数据服务体系。
   - 应用场景：决策分析、推荐、用户画像、OLTP实时交互。





### 成熟的数据中台具备能力

- 汇聚全域数据（采购食材）
- 构建统一的数据资产体系能力（洗、切）
- 完善的数据资产管理能力（菜品/菜谱、质量）
- 工具/组件平台化（打蛋器等机械设备）
- 流程可视化
- 系统架构与组织架构匹配（工种）



### 数据中台架构

1. 数据资源
   - RDBPM
   - NoSQL
   - 消息队列
   - 文件系统
   - 数据服务的数据
2. 计算存储
   - HDFS
   - Kafka
   - MPP
   - Spark
   - Flink
3. 数据汇聚
   - 异构数据源
   - 离线/实时
   - 配置管理
4. 数据资产
   - ODS
   - 公共明细层DWD
   - 公共汇总层DWS
   - 标签数据
   - 应用数据
5. 数据服务
   - API服务
   - 鉴权管理
   - 即席查询
   - 在线查询
6. 资产管理
   - 元数据管理
   - 数据血缘
   - 数据质量
   - 生命周期
   - 资产目录管理
7. 数据运营管理
8. 数据安全管理
9. 数据开发管理
   - 数据同步套件
   - SDK套件
   - 数据开发套件
   - 调度套件
   - 小文件合并
10. 数据应用
    - BI分析
    - 用户画像
    - 推荐系统
    - 业务中台



### 技术选型

- 数据采集汇聚

  - 日志实时采集：Filebeat、Flume等。
  - 数据库实时同步：MaxWell、cancel、OGG。
  - 离线数据交换：Sqoop、DataX、自研产品。

- 数据存储

  - Hadoop分布式文件系统HDFS。
  - 流式数据总线的消息队列Kafka。
  - 海量数据随机查询Hbase/Phoenix。
  - 搜索引擎Elasticsearch。
  - MPP数据库Clickhouse。

- 计算引擎

  - 离线计算：Spark、Hive
  - 实时计算：Spark Streaming、Structured Streaming、Flink

- 即席查询

  - ROLAP：Presto、ClickHouse、Doris
  - MOLAP：Kylin、Druid

- 在线查询

  - 延迟响应要求高：Redis
  - 延迟响应要求正常：Mysql、TIDB、Hbase
  - 检索场景：Elasticsearch

- 数据调度

  AzKaban、Airflow、DolphinScheduler

## 基于Spark的多源异构数据同步套件

-  数据采集、汇聚的技术架构
  - 数据采集内容和方式
  - 实时/离线同步流程

- 构建异构数据源的同步套件
  - 当前工具和方法存储的问题
    - 开源工具问题分析
    - 定制程序问题分析
  - 异构数据同步套件具备的功能



- 移植DataX的配置管理功能

  - DataX数据同步案例

    基于Reader、Transformer和Writer模块，同步MySQL表至HDFS

  - 移植DataX配置管理功能方式

    - 方式一：摘取DataX配置管理相关的源码
    - 方式二：datax-common-0.0.1-SNAPSHOT.java

  - 配置管理的功能点及代码示例

    - 获取基本数据类型
    - 获取Config对象
    - 获取Config对象列表
    - 获取Map集合
    - 获取列表
    - 多个配置合并



- 关系型数据库同步至HDFS的通用套件

  - 需求

    基于配置，零代码开发，实现关系型数据库（MySQL/Oracle等）的表数据同步至HDFS，数据转换模块的插件化管理。

  - 实现过程

    1. 阶段1：关系型数据库同步至HDFS的功能开发，以硬编码方式。
    2. 阶段2：仿照DataX的运行模型，将同步流程抽象为Reader、Transformer和Writer模块。
    3. 阶段3：数据转换的插件化改造，功能扩展时（例如需求变更）无需修改代码。



- 基于Spark的数据同步套件设计思路
  - 基本的数据同步套件
  - 多数据源的数据同步套件





## 













![image-20230321171657286](https://p.ipic.vip/rabaw0.png)





![image-20230321174046672](https://p.ipic.vip/5gq3t3.png)

### 数据资产

- ODS（原始数据层）：尽可能保留与原始数据一致。 
- DWD（公共明细层）：
- DWS（公共汇总层）：是数据资产的主体内容，一般是采用纬度建模的方式进行设计。这两层的数据是通过ODS层的数据清洗加工转换生成的。
- ADS（应用层）：各个业务线基于公共明细层和公共汇总层建立起来的。 

### 数据服务



### 资产管理

作为一个成熟的数据中台的架构，应该能够以可视化的方式来直观的管理和展示数据化资产。

- 元数据管理
- 数据血缘
- 数据质量
- 生命周期
- 资产目录



### 数据运营管理

### 数据安全管理

这两个模块保证数据中台健康稳定运行，持续产生价值的保证。



### 数据开发管理

贯穿了数据中台的 ，始终提供各类数据的套件和工具。

- 数据同步套件：在各种组件之间进行数据的交换，包括数据的读取、转换和写入。
- 数据开发套件：对数据的处理程序进行封装，如离线的开发套件使用SparkSQL作为底层的引擎进行封装，开发人员只需要Web页面编写SQL代码并进行简单的配置就可以完成数据的处理。
- 调度管理：管理数据开发任务之间的依赖问题。
- 小文件合并：一些合并的工具。

### 数据应用

各类数据的应用，数据资产层进行各种计算所产生的结果通过各种途径输送至业务的场景中。

- BI分析
- 用户画像
- 推荐系统
- 业务中台



## 数据采集

![image-20230321174220284](https://p.ipic.vip/53maja.png)